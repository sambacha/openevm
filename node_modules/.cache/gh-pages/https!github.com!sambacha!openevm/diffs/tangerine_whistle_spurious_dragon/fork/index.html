<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ethereum Specification &mdash; Ethereum Specification  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/dropdown.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/js/toggle_diffs.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Ethereum Tangerine WhistleSpurious Dragon Hardfork" href="../index.html" />
    <link rel="prev" title="Tangerine Whistle → Spurious Dragon" href="../../tangerine_whistle_spurious_dragon.html" /> 
</head>

<body class="wy-body-for-nav">
<div id="disclaimer">
    The documentation tools are undergoing heavy development and may introduce
    subtle bugs while rendering, especially in hard fork comparisons. Until this
    warning is removed, <em>always</em> double check against the
    <a href="https://github.com/ethereum/execution-specs/">original source</a>.
</div>


<nav class="menu">
    <button id="diff-toggle">Only Show Diffs</button>
</nav>


 

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Ethereum Specification
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">Specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/ethereum/index.html">Ethereum</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/frontier/index.html">Ethereum Frontier Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/homestead/index.html">Ethereum Homestead Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/dao_fork/index.html">Ethereum Dao Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/tangerine_whistle/index.html">Ethereum Tangerine Whistle Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/spurious_dragon/index.html">Ethereum Spurious Dragon Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/byzantium/index.html">Ethereum Byzantium Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/constantinople/index.html">Ethereum Constantinople Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/istanbul/index.html">Ethereum Istanbul Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/muir_glacier/index.html">Ethereum Muir Glacier Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/berlin/index.html">Ethereum Berlin Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/london/index.html">Ethereum London Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/arrow_glacier/index.html">Ethereum Arrow Glacier Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/gray_glacier/index.html">Ethereum Gray Glacier Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/paris/index.html">Ethereum Paris Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/shanghai/index.html">Ethereum Shanghai Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/crypto/index.html">Cryptographic Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/utils/index.html">Utility Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/base_types/index.html">Numeric &amp; Array Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/ethash/index.html">Ethash Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/exceptions/index.html">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/fork_criteria/index.html">Fork Criteria</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/genesis/index.html">Genesis Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/ethereum/rlp/index.html">Recursive Length Prefix (RLP) Encoding</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Comparisons:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Comparisons</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../frontier_homestead.html">Frontier → Homestead</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../frontier_homestead/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../frontier_homestead/fork_types/index.html">Ethereum Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../frontier_homestead/index.html">Ethereum <span class="change-replaced">Frontier</span><span class="change-replacement">Homestead</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../frontier_homestead/trie/index.html">State Trie</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../frontier_homestead/utils/message/index.html">Hardfork Utility Functions For The Message Data-structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../frontier_homestead/vm/index.html">Ethereum Virtual Machine (EVM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../frontier_homestead/vm/instructions/index.html">EVM Instruction Encoding (Opcodes)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../frontier_homestead/vm/instructions/system/index.html">Ethereum Virtual Machine (EVM) System Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../frontier_homestead/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../homestead_dao_fork.html">Homestead → Dao Fork</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../homestead_dao_fork/dao/index.html">Dao Fork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../homestead_dao_fork/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../homestead_dao_fork/index.html">Ethereum <span class="change-replaced">Homestead</span><span class="change-replacement">Dao</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../homestead_dao_fork/vm/index.html">Ethereum Virtual Machine (EVM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../homestead_dao_fork/vm/instructions/system/index.html">Ethereum Virtual Machine (EVM) System Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../homestead_dao_fork/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dao_fork_tangerine_whistle.html">Dao Fork → Tangerine Whistle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dao_fork_tangerine_whistle/dao/index.html">Dao Fork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dao_fork_tangerine_whistle/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dao_fork_tangerine_whistle/index.html">Ethereum <span class="change-replaced">Dao</span><span class="change-replacement">Tangerine Whistle</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dao_fork_tangerine_whistle/vm/gas/index.html">Ethereum Virtual Machine (EVM) Gas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dao_fork_tangerine_whistle/vm/index.html">Ethereum Virtual Machine (EVM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dao_fork_tangerine_whistle/vm/instructions/system/index.html">Ethereum Virtual Machine (EVM) System Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dao_fork_tangerine_whistle/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../../tangerine_whistle_spurious_dragon.html">Tangerine Whistle → Spurious Dragon</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html">Ethereum <span class="change-replaced">Tangerine Whistle</span><span class="change-replacement">Spurious Dragon</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../state/index.html">State</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vm/gas/index.html">Ethereum Virtual Machine (EVM) Gas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vm/index.html">Ethereum Virtual Machine (EVM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vm/instructions/system/index.html">Ethereum Virtual Machine (EVM) System Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../spurious_dragon_byzantium.html">Spurious Dragon → Byzantium</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/fork_types/index.html">Ethereum Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/index.html">Ethereum <span class="change-replaced">Spurious Dragon</span><span class="change-replacement">Byzantium</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/utils/message/index.html">Hardfork Utility Functions For The Message Data-structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/exceptions/index.html">Ethereum Virtual Machine (EVM) Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/gas/index.html">Ethereum Virtual Machine (EVM) Gas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/index.html">Ethereum Virtual Machine (EVM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/instructions/environment/index.html">Ethereum Virtual Machine (EVM) Environmental Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/instructions/index.html">EVM Instruction Encoding (Opcodes)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/instructions/log/index.html">Ethereum Virtual Machine (EVM) Logging Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/instructions/storage/index.html">Ethereum Virtual Machine (EVM) Storage Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/instructions/system/index.html">Ethereum Virtual Machine (EVM) System Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/precompiled_contracts/alt_bn128/index.html">Ethereum Virtual Machine (EVM) ALT_BN128 CONTRACTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/precompiled_contracts/index.html">Precompiled Contract Addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/precompiled_contracts/mapping/index.html">Precompiled Contract Addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spurious_dragon_byzantium/vm/precompiled_contracts/modexp/index.html">Ethereum Virtual Machine (EVM) MODEXP PRECOMPILED CONTRACT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../byzantium_constantinople.html">Byzantium → Constantinople</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../byzantium_constantinople/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byzantium_constantinople/index.html">Ethereum <span class="change-replaced">Byzantium</span><span class="change-replacement">Constantinople</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byzantium_constantinople/utils/address/index.html">Hardfork Utility Functions For Addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byzantium_constantinople/vm/gas/index.html">Ethereum Virtual Machine (EVM) Gas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byzantium_constantinople/vm/instructions/bitwise/index.html">Ethereum Virtual Machine (EVM) Bitwise Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byzantium_constantinople/vm/instructions/environment/index.html">Ethereum Virtual Machine (EVM) Environmental Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byzantium_constantinople/vm/instructions/index.html">EVM Instruction Encoding (Opcodes)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byzantium_constantinople/vm/instructions/system/index.html">Ethereum Virtual Machine (EVM) System Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byzantium_constantinople/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../constantinople_istanbul.html">Constantinople → Istanbul</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/fork_types/index.html">Ethereum Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/index.html">Ethereum <span class="change-replaced">Constantinople</span><span class="change-replacement">Istanbul</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/state/index.html">State</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/utils/address/index.html">Hardfork Utility Functions For Addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/exceptions/index.html">Ethereum Virtual Machine (EVM) Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/gas/index.html">Ethereum Virtual Machine (EVM) Gas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/index.html">Ethereum Virtual Machine (EVM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/instructions/block/index.html">Ethereum Virtual Machine (EVM) Block Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/instructions/environment/index.html">Ethereum Virtual Machine (EVM) Environmental Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/instructions/index.html">EVM Instruction Encoding (Opcodes)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/instructions/storage/index.html">Ethereum Virtual Machine (EVM) Storage Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/precompiled_contracts/alt_bn128/index.html">Ethereum Virtual Machine (EVM) ALT_BN128 CONTRACTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/precompiled_contracts/blake2f/index.html">Ethereum Virtual Machine (EVM) Blake2 PRECOMPILED CONTRACT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/precompiled_contracts/index.html">Precompiled Contract Addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../constantinople_istanbul/vm/precompiled_contracts/mapping/index.html">Precompiled Contract Addresses</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../istanbul_muir_glacier.html">Istanbul → Muir Glacier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../istanbul_muir_glacier/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../istanbul_muir_glacier/index.html">Ethereum <span class="change-replaced">Istanbul</span><span class="change-replacement">Muir Glacier</span> Hardfork</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../muir_glacier_berlin.html">Muir Glacier → Berlin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/fork_types/index.html">Ethereum Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/index.html">Ethereum <span class="change-replaced">Muir Glacier</span><span class="change-replacement">Berlin</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/trie/index.html">State Trie</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/utils/message/index.html">Hardfork Utility Functions For The Message Data-structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/vm/gas/index.html">Ethereum Virtual Machine (EVM) Gas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/vm/index.html">Ethereum Virtual Machine (EVM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/vm/instructions/environment/index.html">Ethereum Virtual Machine (EVM) Environmental Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/vm/instructions/storage/index.html">Ethereum Virtual Machine (EVM) Storage Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/vm/instructions/system/index.html">Ethereum Virtual Machine (EVM) System Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../muir_glacier_berlin/vm/precompiled_contracts/modexp/index.html">Ethereum Virtual Machine (EVM) MODEXP PRECOMPILED CONTRACT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../berlin_london.html">Berlin → London</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/fork_types/index.html">Ethereum Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/index.html">Ethereum <span class="change-replaced">Berlin</span><span class="change-replacement">London</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/trie/index.html">State Trie</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/vm/exceptions/index.html">Ethereum Virtual Machine (EVM) Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/vm/gas/index.html">Ethereum Virtual Machine (EVM) Gas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/vm/index.html">Ethereum Virtual Machine (EVM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/vm/instructions/environment/index.html">Ethereum Virtual Machine (EVM) Environmental Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/vm/instructions/index.html">EVM Instruction Encoding (Opcodes)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../berlin_london/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../london_arrow_glacier.html">London → Arrow Glacier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../london_arrow_glacier/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../london_arrow_glacier/index.html">Ethereum <span class="change-replaced">London</span><span class="change-replacement">Arrow Glacier</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../london_arrow_glacier/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../arrow_glacier_gray_glacier.html">Arrow Glacier → Gray Glacier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../arrow_glacier_gray_glacier/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../arrow_glacier_gray_glacier/index.html">Ethereum <span class="change-replaced">Arrow</span><span class="change-replacement">Gray</span> Glacier Hardfork</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../gray_glacier_paris.html">Gray Glacier → Paris</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../gray_glacier_paris/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gray_glacier_paris/fork_types/index.html">Ethereum Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gray_glacier_paris/index.html">Ethereum <span class="change-replaced">Gray Glacier</span><span class="change-replacement">Paris</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gray_glacier_paris/state/index.html">State</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gray_glacier_paris/vm/index.html">Ethereum Virtual Machine (EVM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gray_glacier_paris/vm/instructions/block/index.html">Ethereum Virtual Machine (EVM) Block Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gray_glacier_paris/vm/instructions/index.html">EVM Instruction Encoding (Opcodes)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gray_glacier_paris/vm/interpreter/index.html">Ethereum Virtual Machine (EVM) Interpreter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../paris_shanghai.html">Paris → Shanghai</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../paris_shanghai/fork/index.html">Ethereum Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../paris_shanghai/fork_types/index.html">Ethereum Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../paris_shanghai/index.html">Ethereum <span class="change-replaced">Paris</span><span class="change-replacement">Shanghai</span> Hardfork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../paris_shanghai/state/index.html">State</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../paris_shanghai/trie/index.html">State Trie</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../paris_shanghai/vm/gas/index.html">Ethereum Virtual Machine (EVM) Gas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../paris_shanghai/vm/instructions/index.html">EVM Instruction Encoding (Opcodes)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../paris_shanghai/vm/instructions/stack/index.html">Ethereum Virtual Machine (EVM) Stack Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../paris_shanghai/vm/instructions/system/index.html">Ethereum Virtual Machine (EVM) System Instructions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Ethereum Specification</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Comparisons</a></li>
          <li class="breadcrumb-item"><a href="../../tangerine_whistle_spurious_dragon.html">Tangerine Whistle → Spurious Dragon</a></li>
      <li class="breadcrumb-item active">Ethereum Specification</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/diffs/tangerine_whistle_spurious_dragon/fork/index.pickle64.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="module-ethereum.tangerine_whistle.fork"></span><section id="ethereum-specification">
<h1>Ethereum Specification<a class="headerlink" href="#ethereum-specification" title="Permalink to this headline"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#module-contents" id="id2">Module Contents</a></p>
<ul>
<li><p><a class="reference internal" href="#classes" id="id3">Classes</a></p></li>
<li><p><a class="reference internal" href="#functions" id="id4">Functions</a></p></li>
<li><p><a class="reference internal" href="#attributes" id="id5">Attributes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#module-details" id="id6">Module Details</a></p>
<ul>
<li><p><a class="reference internal" href="#block-reward" id="id7">BLOCK_REWARD</a></p></li>
<li><p><a class="reference internal" href="#gas-limit-adjustment-factor" id="id8">GAS_LIMIT_ADJUSTMENT_FACTOR</a></p></li>
<li><p><a class="reference internal" href="#gas-limit-minimum" id="id9">GAS_LIMIT_MINIMUM</a></p></li>
<li><p><a class="reference internal" href="#minimum-difficulty" id="id10">MINIMUM_DIFFICULTY</a></p></li>
<li><p><a class="reference internal" href="#max-ommer-depth" id="id11">MAX_OMMER_DEPTH</a></p></li>
<li><p><a class="reference internal" href="#blockchain" id="id12">BlockChain</a></p></li>
<li><p><a class="reference internal" href="#apply-fork" id="id13">apply_fork</a></p></li>
<li><p><a class="reference internal" href="#get-last-256-block-hashes" id="id14">get_last_256_block_hashes</a></p></li>
<li><p><a class="reference internal" href="#state-transition" id="id15">state_transition</a></p></li>
<li><p><a class="reference internal" href="#validate-header" id="id16">validate_header</a></p></li>
<li><p><a class="reference internal" href="#generate-header-hash-for-pow" id="id17">generate_header_hash_for_pow</a></p></li>
<li><p><a class="reference internal" href="#validate-proof-of-work" id="id18">validate_proof_of_work</a></p></li>
<li><p><a class="reference internal" href="#check-transaction" id="id19">check_transaction</a></p></li>
<li><p><a class="reference internal" href="#make-receipt" id="id20">make_receipt</a></p></li>
<li><p><a class="reference internal" href="#apply-body" id="id21">apply_body</a></p></li>
<li><p><a class="reference internal" href="#validate-ommers" id="id22">validate_ommers</a></p></li>
<li><p><a class="reference internal" href="#pay-rewards" id="id23">pay_rewards</a></p></li>
<li><p><a class="reference internal" href="#process-transaction" id="id24">process_transaction</a></p></li>
<li><p><a class="reference internal" href="#validate-transaction" id="id25">validate_transaction</a></p></li>
<li><p><a class="reference internal" href="#calculate-intrinsic-cost" id="id26">calculate_intrinsic_cost</a></p></li>
<li><p><a class="reference internal" href="#recover-sender" id="id27">recover_sender</a></p></li>
<li class="change-replaced"><p><a class="reference internal" href="#signing-hash" id="id28">signing_hash</a></p></li>
<li class="change-replacement"><p><a class="reference internal" href="#signing-hash-pre155" id="id28">signing_hash_pre155</a></p></li>
<li class="change-added"><p><a class="reference internal" href="#signing-hash-155" id="id29">signing_hash_155</a></p></li>
<li><p><a class="reference internal" href="#compute-header-hash" id="id29">compute_header_hash</a></p></li>
<li><p><a class="reference internal" href="#check-gas-limit" id="id30">check_gas_limit</a></p></li>
<li><p><a class="reference internal" href="#calculate-block-difficulty" id="id31">calculate_block_difficulty</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p>Entry point for the Ethereum specification.</p>
</section>
<section id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline"></a></h2>
<section id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this headline"></a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.BlockChain" title="ethereum.tangerine_whistle.fork.BlockChain"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BlockChain</span></code></a></p></td>
<td><p>History and current state of the block chain.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline"></a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.apply_fork" title="ethereum.tangerine_whistle.fork.apply_fork"><code class="xref py py-obj docutils literal notranslate"><span class="pre">apply_fork</span></code></a></p></td>
<td><p>Transforms the state from the previous hard fork (<cite>old</cite>) into the block</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.get_last_256_block_hashes" title="ethereum.tangerine_whistle.fork.get_last_256_block_hashes"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_last_256_block_hashes</span></code></a></p></td>
<td><p>Obtain the list of hashes of the previous 256 blocks in order of</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.state_transition" title="ethereum.tangerine_whistle.fork.state_transition"><code class="xref py py-obj docutils literal notranslate"><span class="pre">state_transition</span></code></a></p></td>
<td><p>Attempts to apply a block to an existing block chain.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.validate_header" title="ethereum.tangerine_whistle.fork.validate_header"><code class="xref py py-obj docutils literal notranslate"><span class="pre">validate_header</span></code></a></p></td>
<td><p>Verifies a block header.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.generate_header_hash_for_pow" title="ethereum.tangerine_whistle.fork.generate_header_hash_for_pow"><code class="xref py py-obj docutils literal notranslate"><span class="pre">generate_header_hash_for_pow</span></code></a></p></td>
<td><p>Generate rlp hash of the header which is to be used for Proof-of-Work</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.validate_proof_of_work" title="ethereum.tangerine_whistle.fork.validate_proof_of_work"><code class="xref py py-obj docutils literal notranslate"><span class="pre">validate_proof_of_work</span></code></a></p></td>
<td><p>Validates the Proof of Work constraints.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.check_transaction" title="ethereum.tangerine_whistle.fork.check_transaction"><code class="xref py py-obj docutils literal notranslate"><span class="pre">check_transaction</span></code></a></p></td>
<td><p>Check if the transaction is includable in the block.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.make_receipt" title="ethereum.tangerine_whistle.fork.make_receipt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">make_receipt</span></code></a></p></td>
<td><p>Make the receipt for a transaction that was executed.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.apply_body" title="ethereum.tangerine_whistle.fork.apply_body"><code class="xref py py-obj docutils literal notranslate"><span class="pre">apply_body</span></code></a></p></td>
<td><p>Executes a block.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.validate_ommers" title="ethereum.tangerine_whistle.fork.validate_ommers"><code class="xref py py-obj docutils literal notranslate"><span class="pre">validate_ommers</span></code></a></p></td>
<td><p>Validates the ommers mentioned in the block.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.pay_rewards" title="ethereum.tangerine_whistle.fork.pay_rewards"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pay_rewards</span></code></a></p></td>
<td><p>Pay rewards to the block miner as well as the ommers miners.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.process_transaction" title="ethereum.tangerine_whistle.fork.process_transaction"><code class="xref py py-obj docutils literal notranslate"><span class="pre">process_transaction</span></code></a></p></td>
<td><p>Execute a transaction against the provided environment.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.validate_transaction" title="ethereum.tangerine_whistle.fork.validate_transaction"><code class="xref py py-obj docutils literal notranslate"><span class="pre">validate_transaction</span></code></a></p></td>
<td><p>Verifies a transaction.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.calculate_intrinsic_cost" title="ethereum.tangerine_whistle.fork.calculate_intrinsic_cost"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calculate_intrinsic_cost</span></code></a></p></td>
<td><p>Calculates the gas that is charged before execution is started.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.recover_sender" title="ethereum.tangerine_whistle.fork.recover_sender"><code class="xref py py-obj docutils literal notranslate"><span class="pre">recover_sender</span></code></a></p></td>
<td><p>Extracts the sender address from a transaction.</p></td>
</tr>
<tr class="row-even"><td><p class="change-replaced"><a class="reference internal" href="#ethereum.tangerine_whistle.fork.signing_hash" title="ethereum.tangerine_whistle.fork.signing_hash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">signing_hash</span></code></a></p>
<p class="change-replacement"><a class="reference internal" href="#ethereum.spurious_dragon.fork.signing_hash_pre155" title="ethereum.spurious_dragon.fork.signing_hash_pre155"><code class="xref py py-obj docutils literal notranslate"><span class="pre">signing_hash_pre155</span></code></a></p>
</td>
<td><p>Compute the hash of a transaction used in <span class="change-replaced">the</span><span class="change-replacement">a legacy (pre EIP 155)</span> signature.</p></td>
</tr>
<tr class="change-added row-odd"><td><p><a class="reference internal" href="#ethereum.spurious_dragon.fork.signing_hash_155" title="ethereum.spurious_dragon.fork.signing_hash_155"><code class="xref py py-obj docutils literal notranslate"><span class="pre">signing_hash_155</span></code></a></p></td>
<td><p>Compute the hash of a transaction used in a EIP 155 signature.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.compute_header_hash" title="ethereum.tangerine_whistle.fork.compute_header_hash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_header_hash</span></code></a></p></td>
<td><p>Computes the hash of a block header.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.check_gas_limit" title="ethereum.tangerine_whistle.fork.check_gas_limit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">check_gas_limit</span></code></a></p></td>
<td><p>Validates the gas limit for a block.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.calculate_block_difficulty" title="ethereum.tangerine_whistle.fork.calculate_block_difficulty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calculate_block_difficulty</span></code></a></p></td>
<td><p>Computes difficulty of a block using its header and parent header.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline"></a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.BLOCK_REWARD" title="ethereum.tangerine_whistle.fork.BLOCK_REWARD"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BLOCK_REWARD</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.GAS_LIMIT_ADJUSTMENT_FACTOR" title="ethereum.tangerine_whistle.fork.GAS_LIMIT_ADJUSTMENT_FACTOR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GAS_LIMIT_ADJUSTMENT_FACTOR</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.GAS_LIMIT_MINIMUM" title="ethereum.tangerine_whistle.fork.GAS_LIMIT_MINIMUM"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GAS_LIMIT_MINIMUM</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.MINIMUM_DIFFICULTY" title="ethereum.tangerine_whistle.fork.MINIMUM_DIFFICULTY"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MINIMUM_DIFFICULTY</span></code></a></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#ethereum.tangerine_whistle.fork.MAX_OMMER_DEPTH" title="ethereum.tangerine_whistle.fork.MAX_OMMER_DEPTH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MAX_OMMER_DEPTH</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="module-details">
<h2>Module Details<a class="headerlink" href="#module-details" title="Permalink to this headline"></a></h2>
<section id="block-reward">
<h3>BLOCK_REWARD<a class="headerlink" href="#block-reward" title="Permalink to this headline"></a></h3>
<dl class="py data">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.BLOCK_REWARD">
<span class="sig-name descname"><span class="pre">BLOCK_REWARD</span></span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.BLOCK_REWARD" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">BLOCK_REWARD</span> <span class="o">=</span> <span class="n">U256</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">18</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gas-limit-adjustment-factor">
<h3>GAS_LIMIT_ADJUSTMENT_FACTOR<a class="headerlink" href="#gas-limit-adjustment-factor" title="Permalink to this headline"></a></h3>
<dl class="py data">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.GAS_LIMIT_ADJUSTMENT_FACTOR">
<span class="sig-name descname"><span class="pre">GAS_LIMIT_ADJUSTMENT_FACTOR</span></span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.GAS_LIMIT_ADJUSTMENT_FACTOR" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">GAS_LIMIT_ADJUSTMENT_FACTOR</span> <span class="o">=</span> <span class="mi">1024</span>
</pre></div>
</div>
</section>
<section id="gas-limit-minimum">
<h3>GAS_LIMIT_MINIMUM<a class="headerlink" href="#gas-limit-minimum" title="Permalink to this headline"></a></h3>
<dl class="py data">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.GAS_LIMIT_MINIMUM">
<span class="sig-name descname"><span class="pre">GAS_LIMIT_MINIMUM</span></span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.GAS_LIMIT_MINIMUM" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">GAS_LIMIT_MINIMUM</span> <span class="o">=</span> <span class="mi">5000</span>
</pre></div>
</div>
</section>
<section id="minimum-difficulty">
<h3>MINIMUM_DIFFICULTY<a class="headerlink" href="#minimum-difficulty" title="Permalink to this headline"></a></h3>
<dl class="py data">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.MINIMUM_DIFFICULTY">
<span class="sig-name descname"><span class="pre">MINIMUM_DIFFICULTY</span></span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.MINIMUM_DIFFICULTY" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MINIMUM_DIFFICULTY</span> <span class="o">=</span> <span class="n">Uint</span><span class="p">(</span><span class="mi">131072</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="max-ommer-depth">
<h3>MAX_OMMER_DEPTH<a class="headerlink" href="#max-ommer-depth" title="Permalink to this headline"></a></h3>
<dl class="py data">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.MAX_OMMER_DEPTH">
<span class="sig-name descname"><span class="pre">MAX_OMMER_DEPTH</span></span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.MAX_OMMER_DEPTH" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MAX_OMMER_DEPTH</span> <span class="o">=</span> <span class="mi">6</span>
</pre></div>
</div>
</section>
<section id="blockchain">
<h3>BlockChain<a class="headerlink" href="#blockchain" title="Permalink to this headline"></a></h3>
<p>History and current state of the block chain.</p>
<dl class="py class">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.BlockChain">
<em class="property"><span class="pre">class</span> </em><span class="sig-name descname"><span class="pre">BlockChain</span></span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.BlockChain" title="Permalink to this definition"></a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.BlockChain.blocks">
<span class="sig-name descname"><span class="pre">blocks</span></span><em class="property"> <span class="change-replaced"><span class="pre">:List[ethereum.tangerine_whistle.fork_types.Block]</span></span><span class="change-replacement"><span class="pre">:List[ethereum.spurious_dragon.fork_types.Block]</span></span></em><a class="headerlink" href="#ethereum.tangerine_whistle.fork.BlockChain.blocks" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.BlockChain.state">
<span class="sig-name descname"><span class="pre">state</span></span><em class="property"> <span class="change-replaced"><span class="pre">:ethereum.tangerine_whistle.state.State</span></span><span class="change-replacement"><span class="pre">:ethereum.spurious_dragon.state.State</span></span></em><a class="headerlink" href="#ethereum.tangerine_whistle.fork.BlockChain.state" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.BlockChain.chain_id">
<span class="sig-name descname"><span class="pre">chain_id</span></span><em class="property"> <span class="pre">:ethereum.base_types.U64</span></em><a class="headerlink" href="#ethereum.tangerine_whistle.fork.BlockChain.chain_id" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="apply-fork">
<h3>apply_fork<a class="headerlink" href="#apply-fork" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.apply_fork">
<span class="sig-name descname"><span class="pre">apply_fork</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">old</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.apply_fork" title="Permalink to this definition"></a></dt>
<dd><p>Transforms the state from the previous hard fork (<cite>old</cite>) into the block
chain object for this hard fork and returns it.</p>
<p>When forks need to implement an irregular state transition, this function
is used to handle the irregularity. See the <a class="reference internal" href="../../dao_fork/fork/index.pickle#dao-fork"><span class="std std-ref">DAO Fork</span></a> for
an example.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>old</strong> – Previous block chain object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>new</strong> – Upgraded block chain object for this hard fork.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>BlockChain</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">apply_fork</span><span class="p">(</span><span class="n">old</span><span class="p">:</span> <span class="n">BlockChain</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BlockChain</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">old</span>
</pre></div>
</div>
</section>
<section id="get-last-256-block-hashes">
<h3>get_last_256_block_hashes<a class="headerlink" href="#get-last-256-block-hashes" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.get_last_256_block_hashes">
<span class="sig-name descname"><span class="pre">get_last_256_block_hashes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chain</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.get_last_256_block_hashes" title="Permalink to this definition"></a></dt>
<dd><p>Obtain the list of hashes of the previous 256 blocks in order of
increasing block number.</p>
<p>This function will return less hashes for the first 256 blocks.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BLOCKHASH</span></code> opcode needs to access the latest hashes on the chain,
therefore this function retrieves them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>chain</strong> – History and current state.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>recent_block_hashes</strong> – Hashes of the recent 256 blocks in order of increasing block number.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>List[Hash32]</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_last_256_block_hashes</span><span class="p">(</span><span class="n">chain</span><span class="p">:</span> <span class="n">BlockChain</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Hash32</span><span class="p">]:</span>
    <span class="n">recent_blocks</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="o">-</span><span class="mi">255</span><span class="p">:]</span>
    <span class="c1"># TODO: This function has not been tested rigorously</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_blocks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">recent_block_hashes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">recent_blocks</span><span class="p">:</span>
        <span class="n">prev_block_hash</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">parent_hash</span>
        <span class="n">recent_block_hashes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prev_block_hash</span><span class="p">)</span>

    <span class="c1"># We are computing the hash only for the most recent block and not for</span>
    <span class="c1"># the rest of the blocks as they have successors which have the hash of</span>
    <span class="c1"># the current block as parent hash.</span>
    <span class="n">most_recent_block_hash</span> <span class="o">=</span> <span class="n">keccak256</span><span class="p">(</span><span class="n">rlp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">recent_blocks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">))</span>
    <span class="n">recent_block_hashes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">most_recent_block_hash</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">recent_block_hashes</span>
</pre></div>
</div>
</section>
<section id="state-transition">
<h3>state_transition<a class="headerlink" href="#state-transition" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.state_transition">
<span class="sig-name descname"><span class="pre">state_transition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.state_transition" title="Permalink to this definition"></a></dt>
<dd><p>Attempts to apply a block to an existing block chain.</p>
<p>All parts of the block’s contents need to be verified before being added
to the chain. Blocks are verified by ensuring that the contents of the
block make logical sense with the contents of the parent block. The
information in the block’s header must also match the corresponding
information in the block.</p>
<p>To implement Ethereum, in theory clients are only required to store the
most recent 255 blocks of the chain since as far as execution is
concerned, only those blocks are accessed. Practically, however, clients
should store more blocks to handle reorgs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>chain</strong> – History and current state.</p></li>
<li><p><strong>block</strong> – Block to apply to <cite>chain</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<pre class="literal-block">def state_transition(chain: BlockChain, block: Block) -&gt; None:
    parent_header = chain.blocks[-1].header
    validate_header(block.header, parent_header)
    validate_ommers(block.ommers, block.header, chain)
    (
        gas_used,
        transactions_root,
        receipt_root,
        block_logs_bloom,
        state,
    ) = apply_body(
        chain.state,
        get_last_256_block_hashes(chain),
        block.header.coinbase,
        block.header.number,
        block.header.gas_limit,
        block.header.timestamp,
        block.header.difficulty,
        block.transactions,
        block.ommers,
    <span class="change-added">chain.chain_id,
    </span>)
    ensure(gas_used == block.header.gas_used, InvalidBlock)
    ensure(transactions_root == block.header.transactions_root, InvalidBlock)
    ensure(state_root(state) == block.header.state_root, InvalidBlock)
    ensure(receipt_root == block.header.receipt_root, InvalidBlock)
    ensure(block_logs_bloom == block.header.bloom, InvalidBlock)

    chain.blocks.append(block)
    if len(chain.blocks) &gt; 255:
        # Real clients have to store more blocks to deal with reorgs, but the
        # protocol only requires the last 255
        chain.blocks = chain.blocks[-255:]
</pre>
</section>
<section id="validate-header">
<h3>validate_header<a class="headerlink" href="#validate-header" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.validate_header">
<span class="sig-name descname"><span class="pre">validate_header</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_header</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.validate_header" title="Permalink to this definition"></a></dt>
<dd><p>Verifies a block header.</p>
<p>In order to consider a block’s header valid, the logic for the
quantities in the header should match the logic for the block itself.
For example the header timestamp should be greater than the block’s parent
timestamp because the block was created <em>after</em> the parent block.
Additionally, the block’s number should be directly folowing the parent
block’s number since it is the next block in the sequence.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>header</strong> – Header to check for correctness.</p></li>
<li><p><strong>parent_header</strong> – Parent Header of the header to check for correctness</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate_header</span><span class="p">(</span><span class="n">header</span><span class="p">:</span> <span class="n">Header</span><span class="p">,</span> <span class="n">parent_header</span><span class="p">:</span> <span class="n">Header</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">ensure</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">parent_header</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>
    <span class="n">ensure</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">parent_header</span><span class="o">.</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>
    <span class="n">ensure</span><span class="p">(</span>
        <span class="n">check_gas_limit</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">gas_limit</span><span class="p">,</span> <span class="n">parent_header</span><span class="o">.</span><span class="n">gas_limit</span><span class="p">),</span>
        <span class="n">InvalidBlock</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ensure</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">extra_data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>

    <span class="n">block_difficulty</span> <span class="o">=</span> <span class="n">calculate_block_difficulty</span><span class="p">(</span>
        <span class="n">header</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
        <span class="n">parent_header</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
        <span class="n">parent_header</span><span class="o">.</span><span class="n">difficulty</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ensure</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">difficulty</span> <span class="o">==</span> <span class="n">block_difficulty</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>

    <span class="n">block_parent_hash</span> <span class="o">=</span> <span class="n">keccak256</span><span class="p">(</span><span class="n">rlp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">parent_header</span><span class="p">))</span>
    <span class="n">ensure</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">parent_hash</span> <span class="o">==</span> <span class="n">block_parent_hash</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>

    <span class="n">validate_proof_of_work</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="generate-header-hash-for-pow">
<h3>generate_header_hash_for_pow<a class="headerlink" href="#generate-header-hash-for-pow" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.generate_header_hash_for_pow">
<span class="sig-name descname"><span class="pre">generate_header_hash_for_pow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">header</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.generate_header_hash_for_pow" title="Permalink to this definition"></a></dt>
<dd><p>Generate rlp hash of the header which is to be used for Proof-of-Work
verification.</p>
<p>In other words, the PoW artefacts <cite>mix_digest</cite> and <cite>nonce</cite> are ignored
while calculating this hash.</p>
<p>A particular PoW is valid for a single hash, that hash is computed by
this function. The <cite>nonce</cite> and <cite>mix_digest</cite> are omitted from this hash
because they are being changed by miners in their search for a sufficient
proof-of-work.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>header</strong> – The header object for which the hash is to be generated.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>hash</strong> – The PoW valid rlp hash of the passed in header.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>Hash32</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_header_hash_for_pow</span><span class="p">(</span><span class="n">header</span><span class="p">:</span> <span class="n">Header</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hash32</span><span class="p">:</span>
    <span class="n">header_data_without_pow_artefacts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">header</span><span class="o">.</span><span class="n">parent_hash</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">ommers_hash</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">coinbase</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">state_root</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">transactions_root</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">receipt_root</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">bloom</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">difficulty</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">gas_limit</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">gas_used</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
        <span class="n">header</span><span class="o">.</span><span class="n">extra_data</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">rlp</span><span class="o">.</span><span class="n">rlp_hash</span><span class="p">(</span><span class="n">header_data_without_pow_artefacts</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="validate-proof-of-work">
<h3>validate_proof_of_work<a class="headerlink" href="#validate-proof-of-work" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.validate_proof_of_work">
<span class="sig-name descname"><span class="pre">validate_proof_of_work</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">header</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.validate_proof_of_work" title="Permalink to this definition"></a></dt>
<dd><p>Validates the Proof of Work constraints.</p>
<p>In order to verify that a miner’s proof-of-work is valid for a block, a
<code class="docutils literal notranslate"><span class="pre">mix-digest</span></code> and <code class="docutils literal notranslate"><span class="pre">result</span></code> are calculated using the <code class="docutils literal notranslate"><span class="pre">hashimoto_light</span></code>
hash function. The mix digest is a hash of the header and the nonce that
is passed through and it confirms whether or not proof-of-work was done
on the correct block. The result is the actual hash value of the block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>header</strong> – Header of interest.</p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate_proof_of_work</span><span class="p">(</span><span class="n">header</span><span class="p">:</span> <span class="n">Header</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">header_hash</span> <span class="o">=</span> <span class="n">generate_header_hash_for_pow</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
    <span class="c1"># TODO: Memoize this somewhere and read from that data instead of</span>
    <span class="c1"># calculating cache for every block validation.</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">generate_cache</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
    <span class="n">mix_digest</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">hashimoto_light</span><span class="p">(</span>
        <span class="n">header_hash</span><span class="p">,</span> <span class="n">header</span><span class="o">.</span><span class="n">nonce</span><span class="p">,</span> <span class="n">cache</span><span class="p">,</span> <span class="n">dataset_size</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">ensure</span><span class="p">(</span><span class="n">mix_digest</span> <span class="o">==</span> <span class="n">header</span><span class="o">.</span><span class="n">mix_digest</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>
    <span class="n">ensure</span><span class="p">(</span>
        <span class="n">Uint</span><span class="o">.</span><span class="n">from_be_bytes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">U256_CEIL_VALUE</span> <span class="o">//</span> <span class="n">header</span><span class="o">.</span><span class="n">difficulty</span><span class="p">),</span>
        <span class="n">InvalidBlock</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-transaction">
<h3>check_transaction<a class="headerlink" href="#check-transaction" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.check_transaction">
<span class="sig-name descname"><span class="pre">check_transaction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gas_available</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chain_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.check_transaction" title="Permalink to this definition"></a></dt>
<dd><p>Check if the transaction is includable in the block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> – The transaction.</p></li>
<li><p><strong>gas_available</strong> – The gas remaining in the block.</p></li>
<li class="change-added"><p><strong>chain_id</strong> – The ID of the current chain.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The sender of the transaction.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>sender_address</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>InvalidBlock :</strong> – If the transaction is not includable.</p>
</dd>
</dl>
</dd></dl>

<pre class="literal-block">def check_transaction(
    tx: Transaction,
    gas_available: Uint,
<span class="change-added">chain_id: U64,
</span>) -&gt; Address:
    ensure(tx.gas &lt;= gas_available, InvalidBlock)
    sender_address = <span class="change-replaced">recover_sender(tx)</span><span class="change-replacement">recover_sender(chain_id, tx)</span>

    return sender_address
</pre>
</section>
<section id="make-receipt">
<h3>make_receipt<a class="headerlink" href="#make-receipt" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.make_receipt">
<span class="sig-name descname"><span class="pre">make_receipt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cumulative_gas_used</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.make_receipt" title="Permalink to this definition"></a></dt>
<dd><p>Make the receipt for a transaction that was executed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> – The executed transaction.</p></li>
<li><p><strong>post_state</strong> – The state root immediately after this transaction.</p></li>
<li><p><strong>cumulative_gas_used</strong> – The total gas used so far in the block after the transaction was
executed.</p></li>
<li><p><strong>logs</strong> – The logs produced by the transaction.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The receipt for the transaction.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>receipt</p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_receipt</span><span class="p">(</span>
    <span class="n">tx</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">,</span>
    <span class="n">post_state</span><span class="p">:</span> <span class="n">Bytes32</span><span class="p">,</span>
    <span class="n">cumulative_gas_used</span><span class="p">:</span> <span class="n">Uint</span><span class="p">,</span>
    <span class="n">logs</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Log</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Receipt</span><span class="p">:</span>
    <span class="n">receipt</span> <span class="o">=</span> <span class="n">Receipt</span><span class="p">(</span>
        <span class="n">post_state</span><span class="o">=</span><span class="n">post_state</span><span class="p">,</span>
        <span class="n">cumulative_gas_used</span><span class="o">=</span><span class="n">cumulative_gas_used</span><span class="p">,</span>
        <span class="n">bloom</span><span class="o">=</span><span class="n">logs_bloom</span><span class="p">(</span><span class="n">logs</span><span class="p">),</span>
        <span class="n">logs</span><span class="o">=</span><span class="n">logs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">receipt</span>
</pre></div>
</div>
</section>
<section id="apply-body">
<h3>apply_body<a class="headerlink" href="#apply-body" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.apply_body">
<span class="sig-name descname"><span class="pre">apply_body</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_hashes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coinbase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_gas_limit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_difficulty</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transactions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ommers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chain_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.apply_body" title="Permalink to this definition"></a></dt>
<dd><p>Executes a block.</p>
<p>Many of the contents of a block are stored in data structures called
tries. There is a transactions trie which is similar to a ledger of the
transactions stored in the current block. There is also a receipts trie
which stores the results of executing a transaction, like the post state
and gas used. This function creates and executes the block that is to be
added to the chain.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – Current account state.</p></li>
<li><p><strong>block_hashes</strong> – List of hashes of the previous 256 blocks in the order of
increasing block number.</p></li>
<li><p><strong>coinbase</strong> – Address of account which receives block reward and transaction fees.</p></li>
<li><p><strong>block_number</strong> – Position of the block within the chain.</p></li>
<li><p><strong>block_gas_limit</strong> – Initial amount of gas available for execution in this block.</p></li>
<li><p><strong>block_time</strong> – Time the block was produced, measured in seconds since the epoch.</p></li>
<li><p><strong>block_difficulty</strong> – Difficulty of the block.</p></li>
<li><p><strong>transactions</strong> – Transactions included in the block.</p></li>
<li><p><strong>ommers</strong> – Headers of ancestor blocks which are not direct parents (formerly
uncles.)</p></li>
<li class="change-added"><p><strong>chain_id</strong> – ID of the executing chain.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>gas_available</strong> (<cite>ethereum.base_types.Uint</cite>) – Remaining gas after all transactions have been executed.</p></li>
<li><p><strong>transactions_root</strong> (<cite>ethereum.fork_types.Root</cite>) – Trie root of all the transactions in the block.</p></li>
<li><p><strong>receipt_root</strong> (<cite>ethereum.fork_types.Root</cite>) – Trie root of all the receipts in the block.</p></li>
<li><p><strong>block_logs_bloom</strong> (<cite>Bloom</cite>) – Logs bloom of all the logs included in all the transactions of the
block.</p></li>
<li><p><strong>state</strong> (<cite>ethereum.fork_types.State</cite>) – State after all transactions have been executed.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<pre class="literal-block">def apply_body(
    state: State,
    block_hashes: List[Hash32],
    coinbase: Address,
    block_number: Uint,
    block_gas_limit: Uint,
    block_time: U256,
    block_difficulty: Uint,
    transactions: Tuple[Transaction, ...],
    ommers: Tuple[Header, ...],
<span class="change-added">chain_id: U64,
</span>) -&gt; Tuple[Uint, Root, Root, Bloom, State]:
    gas_available = block_gas_limit
    transactions_trie: Trie[Bytes, Optional[Transaction]] = Trie(
        secured=False, default=None
    )
    receipts_trie: Trie[Bytes, Optional[Receipt]] = Trie(
        secured=False, default=None
    )
    block_logs: Tuple[Log, ...] = ()

    for i, tx in enumerate(transactions):
        trie_set(transactions_trie, rlp.encode(Uint(i)), tx)

        sender_address = check_transaction(tx, <span class="change-replaced">gas_available)</span><span class="change-replacement">gas_available, chain_id)</span>

        env = vm.Environment(
            caller=sender_address,
            origin=sender_address,
            block_hashes=block_hashes,
            coinbase=coinbase,
            number=block_number,
            gas_limit=block_gas_limit,
            gas_price=tx.gas_price,
            time=block_time,
            difficulty=block_difficulty,
            state=state,
        )

        gas_used, logs = process_transaction(env, tx)
        gas_available -= gas_used

        receipt = make_receipt(
            tx, state_root(state), (block_gas_limit - gas_available), logs
        )

        trie_set(
            receipts_trie,
            rlp.encode(Uint(i)),
            receipt,
        )

        block_logs += logs

    pay_rewards(state, block_number, coinbase, ommers)

    block_gas_used = block_gas_limit - gas_available

    block_logs_bloom = logs_bloom(block_logs)

    return (
        block_gas_used,
        root(transactions_trie),
        root(receipts_trie),
        block_logs_bloom,
        state,
    )
</pre>
</section>
<section id="validate-ommers">
<h3>validate_ommers<a class="headerlink" href="#validate-ommers" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.validate_ommers">
<span class="sig-name descname"><span class="pre">validate_ommers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ommers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chain</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.validate_ommers" title="Permalink to this definition"></a></dt>
<dd><p>Validates the ommers mentioned in the block.</p>
<p>An ommer block is a block that wasn’t canonically added to the
blockchain because it wasn’t validated as fast as the canonical block
but was mined at the same time.</p>
<p>To be considered valid, the ommers must adhere to the rules defined in
the Ethereum protocol. The maximum amount of ommers is 2 per block and
there cannot be duplicate ommers in a block. Many of the other ommer
contraints are listed in the in-line comments of this function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ommers</strong> – List of ommers mentioned in the current block.</p></li>
<li><p><strong>block_header</strong> – The header of current block.</p></li>
<li><p><strong>chain</strong> – History and current state.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate_ommers</span><span class="p">(</span>
    <span class="n">ommers</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Header</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">block_header</span><span class="p">:</span> <span class="n">Header</span><span class="p">,</span> <span class="n">chain</span><span class="p">:</span> <span class="n">BlockChain</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">block_hash</span> <span class="o">=</span> <span class="n">rlp</span><span class="o">.</span><span class="n">rlp_hash</span><span class="p">(</span><span class="n">block_header</span><span class="p">)</span>

    <span class="n">ensure</span><span class="p">(</span><span class="n">rlp</span><span class="o">.</span><span class="n">rlp_hash</span><span class="p">(</span><span class="n">ommers</span><span class="p">)</span> <span class="o">==</span> <span class="n">block_header</span><span class="o">.</span><span class="n">ommers_hash</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ommers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Nothing to validate</span>
        <span class="k">return</span>

    <span class="c1"># Check that each ommer satisfies the constraints of a header</span>
    <span class="k">for</span> <span class="n">ommer</span> <span class="ow">in</span> <span class="n">ommers</span><span class="p">:</span>
        <span class="n">ensure</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">ommer</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="n">block_header</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>
        <span class="n">ommer_parent_header</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span>
            <span class="o">-</span><span class="p">(</span><span class="n">block_header</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="n">ommer</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">validate_header</span><span class="p">(</span><span class="n">ommer</span><span class="p">,</span> <span class="n">ommer_parent_header</span><span class="p">)</span>

    <span class="c1"># Check that there can be only at most 2 ommers for a block.</span>
    <span class="n">ensure</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ommers</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>

    <span class="n">ommers_hashes</span> <span class="o">=</span> <span class="p">[</span><span class="n">rlp</span><span class="o">.</span><span class="n">rlp_hash</span><span class="p">(</span><span class="n">ommer</span><span class="p">)</span> <span class="k">for</span> <span class="n">ommer</span> <span class="ow">in</span> <span class="n">ommers</span><span class="p">]</span>
    <span class="c1"># Check that there are no duplicates in the ommers of current block</span>
    <span class="n">ensure</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ommers_hashes</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ommers_hashes</span><span class="p">)),</span> <span class="n">InvalidBlock</span><span class="p">)</span>

    <span class="n">recent_canonical_blocks</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">MAX_OMMER_DEPTH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>
    <span class="n">recent_canonical_block_hashes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">rlp</span><span class="o">.</span><span class="n">rlp_hash</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">header</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">recent_canonical_blocks</span>
    <span class="p">}</span>
    <span class="n">recent_ommers_hashes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Hash32</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">recent_canonical_blocks</span><span class="p">:</span>
        <span class="n">recent_ommers_hashes</span> <span class="o">=</span> <span class="n">recent_ommers_hashes</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
            <span class="p">{</span><span class="n">rlp</span><span class="o">.</span><span class="n">rlp_hash</span><span class="p">(</span><span class="n">ommer</span><span class="p">)</span> <span class="k">for</span> <span class="n">ommer</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">ommers</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">ommer_index</span><span class="p">,</span> <span class="n">ommer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ommers</span><span class="p">):</span>
        <span class="n">ommer_hash</span> <span class="o">=</span> <span class="n">ommers_hashes</span><span class="p">[</span><span class="n">ommer_index</span><span class="p">]</span>
        <span class="c1"># The current block shouldn&#39;t be the ommer</span>
        <span class="n">ensure</span><span class="p">(</span><span class="n">ommer_hash</span> <span class="o">!=</span> <span class="n">block_hash</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>

        <span class="c1"># Ommer shouldn&#39;t be one of the recent canonical blocks</span>
        <span class="n">ensure</span><span class="p">(</span><span class="n">ommer_hash</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">recent_canonical_block_hashes</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>

        <span class="c1"># Ommer shouldn&#39;t be one of the uncles mentioned in the recent</span>
        <span class="c1"># canonical blocks</span>
        <span class="n">ensure</span><span class="p">(</span><span class="n">ommer_hash</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">recent_ommers_hashes</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>

        <span class="c1"># Ommer age with respect to the current block. For example, an age of</span>
        <span class="c1"># 1 indicates that the ommer is a sibling of previous block.</span>
        <span class="n">ommer_age</span> <span class="o">=</span> <span class="n">block_header</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="n">ommer</span><span class="o">.</span><span class="n">number</span>
        <span class="n">ensure</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">ommer_age</span> <span class="o">&lt;=</span> <span class="n">MAX_OMMER_DEPTH</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>

        <span class="n">ensure</span><span class="p">(</span>
            <span class="n">ommer</span><span class="o">.</span><span class="n">parent_hash</span> <span class="ow">in</span> <span class="n">recent_canonical_block_hashes</span><span class="p">,</span> <span class="n">InvalidBlock</span>
        <span class="p">)</span>
        <span class="n">ensure</span><span class="p">(</span><span class="n">ommer</span><span class="o">.</span><span class="n">parent_hash</span> <span class="o">!=</span> <span class="n">block_header</span><span class="o">.</span><span class="n">parent_hash</span><span class="p">,</span> <span class="n">InvalidBlock</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pay-rewards">
<h3>pay_rewards<a class="headerlink" href="#pay-rewards" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.pay_rewards">
<span class="sig-name descname"><span class="pre">pay_rewards</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coinbase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ommers</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.pay_rewards" title="Permalink to this definition"></a></dt>
<dd><p>Pay rewards to the block miner as well as the ommers miners.</p>
<p>The miner of the canonical block is rewarded with the predetermined
block reward, <code class="docutils literal notranslate"><span class="pre">BLOCK_REWARD</span></code>, plus a variable award based off of the
number of ommer blocks that were mined around the same time, and included
in the canonical block’s header. An ommer block is a block that wasn’t
added to the canonical blockchain because it wasn’t validated as fast as
the accepted block but was mined at the same time. Although not all blocks
that are mined are added to the canonical chain, miners are still paid a
reward for their efforts. This reward is called an ommer reward and is
calculated based on the number associated with the ommer block that they
mined.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – Current account state.</p></li>
<li><p><strong>block_number</strong> – Position of the block within the chain.</p></li>
<li><p><strong>coinbase</strong> – Address of account which receives block reward and transaction fees.</p></li>
<li><p><strong>ommers</strong> – List of ommers mentioned in the current block.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pay_rewards</span><span class="p">(</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span>
    <span class="n">block_number</span><span class="p">:</span> <span class="n">Uint</span><span class="p">,</span>
    <span class="n">coinbase</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
    <span class="n">ommers</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Header</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">miner_reward</span> <span class="o">=</span> <span class="n">BLOCK_REWARD</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ommers</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">BLOCK_REWARD</span> <span class="o">//</span> <span class="mi">32</span><span class="p">))</span>
    <span class="n">create_ether</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">coinbase</span><span class="p">,</span> <span class="n">miner_reward</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ommer</span> <span class="ow">in</span> <span class="n">ommers</span><span class="p">:</span>
        <span class="c1"># Ommer age with respect to the current block.</span>
        <span class="n">ommer_age</span> <span class="o">=</span> <span class="n">U256</span><span class="p">(</span><span class="n">block_number</span> <span class="o">-</span> <span class="n">ommer</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="n">ommer_miner_reward</span> <span class="o">=</span> <span class="p">((</span><span class="mi">8</span> <span class="o">-</span> <span class="n">ommer_age</span><span class="p">)</span> <span class="o">*</span> <span class="n">BLOCK_REWARD</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="n">create_ether</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">ommer</span><span class="o">.</span><span class="n">coinbase</span><span class="p">,</span> <span class="n">ommer_miner_reward</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="process-transaction">
<h3>process_transaction<a class="headerlink" href="#process-transaction" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.process_transaction">
<span class="sig-name descname"><span class="pre">process_transaction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.process_transaction" title="Permalink to this definition"></a></dt>
<dd><p>Execute a transaction against the provided environment.</p>
<p>This function processes the actions needed to execute a transaction.
It decrements the sender’s account after calculating the gas fee and
refunds them the proper amount after execution. Calling contracts,
deploying code, and incrementing nonces are all examples of actions that
happen within this function or from a call made within this function.</p>
<p>Accounts that are marked for deletion are processed and destroyed after
execution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>env</strong> – Environment for the Ethereum Virtual Machine.</p></li>
<li><p><strong>tx</strong> – Transaction to execute.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>gas_left</strong> (<cite>ethereum.base_types.U256</cite>) – Remaining gas after execution.</p></li>
<li><p><strong>logs</strong> (<cite>Tuple[ethereum.fork_types.Log, …]</cite>) – Logs generated during execution.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<pre class="literal-block">def process_transaction(
    env: vm.Environment, tx: Transaction
) -&gt; Tuple[Uint, Tuple[Log, ...]]:
    ensure(validate_transaction(tx), InvalidBlock)

    sender = env.origin
    sender_account = get_account(env.state, sender)
    gas_fee = tx.gas * tx.gas_price
    ensure(sender_account.nonce == tx.nonce, InvalidBlock)
    ensure(sender_account.balance &gt;= gas_fee + tx.value, InvalidBlock)
    ensure(sender_account.code == bytearray(), InvalidBlock)

    gas = tx.gas - calculate_intrinsic_cost(tx)
    increment_nonce(env.state, sender)
    sender_balance_after_gas_fee = sender_account.balance - gas_fee
    set_account_balance(env.state, sender, sender_balance_after_gas_fee)

    message = prepare_message(
        sender,
        tx.to,
        tx.value,
        tx.data,
        gas,
        env,
    )

    output = process_message_call(message, env)

    gas_used = tx.gas - output.gas_left
    gas_refund = min(gas_used // 2, output.refund_counter)
    gas_refund_amount = (output.gas_left + gas_refund) * tx.gas_price
    transaction_fee = (tx.gas - output.gas_left - gas_refund) * tx.gas_price
    total_gas_used = gas_used - gas_refund

    # refund gas
    sender_balance_after_refund = (
        get_account(env.state, sender).balance + gas_refund_amount
    )
    set_account_balance(env.state, sender, sender_balance_after_refund)

    # transfer miner fees
    coinbase_balance_after_mining_fee = (
        get_account(env.state, env.coinbase).balance + transaction_fee
    )<span class="change-added">
    if coinbase_balance_after_mining_fee != 0:</span>
    set_account_balance(
        env.state, env.coinbase, coinbase_balance_after_mining_fee
    )<span class="change-added">
    elif account_exists_and_is_empty(env.state, env.coinbase):
        destroy_account(env.state, env.coinbase)</span>

    for address in output.accounts_to_delete:
        destroy_account(env.state, address)

    <span class="change-added">for address in output.touched_accounts:
        if account_exists_and_is_empty(env.state, address):
            destroy_account(env.state, address)

    </span>return total_gas_used, output.logs
</pre>
</section>
<section id="validate-transaction">
<h3>validate_transaction<a class="headerlink" href="#validate-transaction" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.validate_transaction">
<span class="sig-name descname"><span class="pre">validate_transaction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.validate_transaction" title="Permalink to this definition"></a></dt>
<dd><p>Verifies a transaction.</p>
<p>The gas in a transaction gets used to pay for the intrinsic cost of
operations, therefore if there is insufficient gas then it would not
be possible to execute a transaction and it will be declared invalid.</p>
<p>Additionally, the nonce of a transaction must not equal or exceed the
limit defined in <a class="reference external" href="https://eips.ethereum.org/EIPS/eip-2681">EIP-2681</a>.
In practice, defining the limit as <code class="docutils literal notranslate"><span class="pre">2**64-1</span></code> has no impact because
sending <code class="docutils literal notranslate"><span class="pre">2**64-1</span></code> transactions is improbable. It’s not strictly
impossible though, <code class="docutils literal notranslate"><span class="pre">2**64-1</span></code> transactions is the entire capacity of the
Ethereum blockchain at 2022 gas limits for a little over 22 years.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tx</strong> – Transaction to validate.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>verified</strong> – True if the transaction can be executed, or False otherwise.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>bool</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate_transaction</span><span class="p">(</span><span class="n">tx</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">calculate_intrinsic_cost</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tx</span><span class="o">.</span><span class="n">gas</span> <span class="ow">and</span> <span class="n">tx</span><span class="o">.</span><span class="n">nonce</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">64</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="calculate-intrinsic-cost">
<h3>calculate_intrinsic_cost<a class="headerlink" href="#calculate-intrinsic-cost" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.calculate_intrinsic_cost">
<span class="sig-name descname"><span class="pre">calculate_intrinsic_cost</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.calculate_intrinsic_cost" title="Permalink to this definition"></a></dt>
<dd><p>Calculates the gas that is charged before execution is started.</p>
<p>The intrinsic cost of the transaction is charged before execution has
begun. Functions/operations in the EVM cost money to execute so this
intrinsic cost is for the operations that need to be paid for as part of
the transaction. Data transfer, for example, is part of this intrinsic
cost. It costs ether to send data over the wire and that ether is
accounted for in the intrinsic cost calculated in this function. This
intrinsic cost must be calculated and paid for before execution in order
for all operations to be implemented.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tx</strong> – Transaction to compute the intrinsic cost of.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>verified</strong> – The intrinsic cost of the transaction.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>ethereum.base_types.Uint</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_intrinsic_cost</span><span class="p">(</span><span class="n">tx</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Uint</span><span class="p">:</span>
    <span class="n">data_cost</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">tx</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">byte</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data_cost</span> <span class="o">+=</span> <span class="n">TX_DATA_COST_PER_ZERO</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_cost</span> <span class="o">+=</span> <span class="n">TX_DATA_COST_PER_NON_ZERO</span>

    <span class="k">if</span> <span class="n">tx</span><span class="o">.</span><span class="n">to</span> <span class="o">==</span> <span class="n">Bytes0</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">create_cost</span> <span class="o">=</span> <span class="n">TX_CREATE_COST</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">create_cost</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">Uint</span><span class="p">(</span><span class="n">TX_BASE_COST</span> <span class="o">+</span> <span class="n">data_cost</span> <span class="o">+</span> <span class="n">create_cost</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="recover-sender">
<h3>recover_sender<a class="headerlink" href="#recover-sender" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.recover_sender">
<span class="sig-name descname"><span class="pre">recover_sender</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chain_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.recover_sender" title="Permalink to this definition"></a></dt>
<dd><p>Extracts the sender address from a transaction.</p>
<p>The v, r, and s values are the three parts that make up the signature
of a transaction. In order to recover the sender of a transaction the two
components needed are the signature (<code class="docutils literal notranslate"><span class="pre">v</span></code>, <code class="docutils literal notranslate"><span class="pre">r</span></code>, and <code class="docutils literal notranslate"><span class="pre">s</span></code>) and the
signing hash of the transaction. The sender’s public key can be obtained
with these two values and therefore the sender address can be retrieved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p class="change-replaced"><strong>tx</strong> – Transaction of interest.</p>
<ul class="change-replacement simple">
<li><p><strong>tx</strong> – Transaction of interest.</p></li>
<li><p><strong>chain_id</strong> – ID of the executing chain.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>sender</strong> – The address of the account that signed the transaction.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>ethereum.fork_types.Address</cite></p>
</dd>
</dl>
</dd></dl>

<pre class="literal-block">def <span class="change-replaced">recover_sender(tx:</span><span class="change-replacement">recover_sender(chain_id: U64, tx:</span> Transaction) -&gt; Address:
    v, r, s = tx.v, tx.r, tx.s

    <span class="change-replaced">#</span><span class="change-replacement">ensure(0 &lt; r and r &lt; SECP256K1N, InvalidBlock)
    ensure(0 &lt; s and s &lt;= SECP256K1N // 2, InvalidBlock)</span>  if v <span class="change-replaced">&gt;</span><span class="change-replacement">== 27 or v ==</span> 28:
    <span class="change-replaced">#</span><span class="change-replacement">public_key = secp256k1_recover(r, s,</span>      v <span class="change-added">- 27, signing_hash_pre155(tx))
    else:
        ensure(v == 35 + chain_id * 2 or v == 36 + chain_id * 2, InvalidBlock)
        public_key </span>= <span class="change-added">secp256k1_recover(
            r, s, </span>v - <span class="change-replaced">(chain_id*2+8)

    ensure(v == 27 or v == 28, InvalidBlock)
    ensure(0 &lt; r and r &lt; SECP256K1N, InvalidBlock)
    ensure(0 &lt; s and s &lt;= SECP256K1N //</span><span class="change-replacement">35 - chain_id *</span> 2, <span class="change-replaced">InvalidBlock)

    public_key = secp256k1_recover(r, s, v - 27, signing_hash(tx))</span><span class="change-replacement">signing_hash_155(tx, chain_id)
        )</span>
    return Address(keccak256(public_key)[12:32])
</pre>
</section>
<section class="change-replaced" id="signing-hash">
<h3>signing_hash<a class="headerlink" href="#signing-hash" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.signing_hash">
<span class="sig-name descname"><span class="pre">signing_hash</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.signing_hash" title="Permalink to this definition"></a></dt>
<dd><p>Compute the hash of a transaction used in the signature.</p>
<p>The values that are used to compute the signing hash set the rules for a
transaction. For example, signing over the gas sets a limit for the
amount of money that is allowed to be pulled out of the sender’s account.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tx</strong> – Transaction of interest.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>hash</strong> – Hash of the transaction.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>ethereum.crypto.hash.Hash32</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">signing_hash</span><span class="p">(</span><span class="n">tx</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hash32</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">keccak256</span><span class="p">(</span>
        <span class="n">rlp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">nonce</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">to</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section class="change-replacement" id="signing-hash-pre155">
<h3>signing_hash_pre155<a class="headerlink" href="#signing-hash-pre155" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.spurious_dragon.fork.signing_hash_pre155">
<span class="sig-name descname"><span class="pre">signing_hash_pre155</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.spurious_dragon.fork.signing_hash_pre155" title="Permalink to this definition"></a></dt>
<dd><p>Compute the hash of a transaction used in a legacy (pre EIP 155) signature.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tx</strong> – Transaction of interest.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>hash</strong> – Hash of the transaction.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>ethereum.crypto.hash.Hash32</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">signing_hash_pre155</span><span class="p">(</span><span class="n">tx</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hash32</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">keccak256</span><span class="p">(</span>
        <span class="n">rlp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">nonce</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">to</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section class="change-replacement" id="signing-hash-155">
<h3>signing_hash_155<a class="headerlink" href="#signing-hash-155" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.spurious_dragon.fork.signing_hash_155">
<span class="sig-name descname"><span class="pre">signing_hash_155</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chain_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.spurious_dragon.fork.signing_hash_155" title="Permalink to this definition"></a></dt>
<dd><p>Compute the hash of a transaction used in a EIP 155 signature.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> – Transaction of interest.</p></li>
<li><p><strong>chain_id</strong> – The id of the current chain.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>hash</strong> – Hash of the transaction.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>ethereum.crypto.hash.Hash32</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">signing_hash_155</span><span class="p">(</span><span class="n">tx</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">,</span> <span class="n">chain_id</span><span class="p">:</span> <span class="n">U64</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hash32</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">keccak256</span><span class="p">(</span>
        <span class="n">rlp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">nonce</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">to</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">tx</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="n">chain_id</span><span class="p">,</span>
                <span class="n">Uint</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="n">Uint</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="compute-header-hash">
<h3>compute_header_hash<a class="headerlink" href="#compute-header-hash" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.compute_header_hash">
<span class="sig-name descname"><span class="pre">compute_header_hash</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">header</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.compute_header_hash" title="Permalink to this definition"></a></dt>
<dd><p>Computes the hash of a block header.</p>
<p>The header hash of a block is the canonical hash that is used to refer
to a specific block and completely distinguishes a block from another.</p>
<p><code class="docutils literal notranslate"><span class="pre">keccak256</span></code> is a function that produces a 256 bit hash of any input.
It also takes in any number of bytes as an input and produces a single
hash for them. A hash is a completely unique output for a single input.
So an input corresponds to one unique hash that can be used to identify
the input exactly.</p>
<p>Prior to using the <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> hash function, the header must be
encoded using the Recursive-Length Prefix. See <a class="reference internal" href="../../rlp/index.pickle#rlp"><span class="std std-ref">Recursive Length Prefix (RLP) Encoding</span></a>.
RLP encoding the header converts it into a space-efficient format that
allows for easy transfer of data between nodes. The purpose of RLP is to
encode arbitrarily nested arrays of binary data, and RLP is the primary
encoding method used to serialize objects in Ethereum’s execution layer.
The only purpose of RLP is to encode structure; encoding specific data
types (e.g. strings, floats) is left up to higher-order protocols.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>header</strong> – Header of interest.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>hash</strong> – Hash of the header.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>ethereum.crypto.hash.Hash32</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_header_hash</span><span class="p">(</span><span class="n">header</span><span class="p">:</span> <span class="n">Header</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hash32</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">keccak256</span><span class="p">(</span><span class="n">rlp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="check-gas-limit">
<h3>check_gas_limit<a class="headerlink" href="#check-gas-limit" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.check_gas_limit">
<span class="sig-name descname"><span class="pre">check_gas_limit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gas_limit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_gas_limit</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.check_gas_limit" title="Permalink to this definition"></a></dt>
<dd><p>Validates the gas limit for a block.</p>
<p>The bounds of the gas limit, <code class="docutils literal notranslate"><span class="pre">max_adjustment_delta</span></code>, is set as the
quotient of the parent block’s gas limit and the
<code class="docutils literal notranslate"><span class="pre">GAS_LIMIT_ADJUSTMENT_FACTOR</span></code>. Therefore, if the gas limit that is
passed through as a parameter is greater than or equal to the <em>sum</em> of
the parent’s gas and the adjustment delta then the limit for gas is too
high and fails this function’s check. Similarly, if the limit is less
than or equal to the <em>difference</em> of the parent’s gas and the adjustment
delta <em>or</em> the predefined <code class="docutils literal notranslate"><span class="pre">GAS_LIMIT_MINIMUM</span></code> then this function’s
check fails because the gas limit doesn’t allow for a sufficient or
reasonable amount of gas to be used on a block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gas_limit</strong> – Gas limit to validate.</p></li>
<li><p><strong>parent_gas_limit</strong> – Gas limit of the parent block.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>check</strong> – True if gas limit constraints are satisfied, False otherwise.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>bool</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_gas_limit</span><span class="p">(</span><span class="n">gas_limit</span><span class="p">:</span> <span class="n">Uint</span><span class="p">,</span> <span class="n">parent_gas_limit</span><span class="p">:</span> <span class="n">Uint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">max_adjustment_delta</span> <span class="o">=</span> <span class="n">parent_gas_limit</span> <span class="o">//</span> <span class="n">GAS_LIMIT_ADJUSTMENT_FACTOR</span>
    <span class="k">if</span> <span class="n">gas_limit</span> <span class="o">&gt;=</span> <span class="n">parent_gas_limit</span> <span class="o">+</span> <span class="n">max_adjustment_delta</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">gas_limit</span> <span class="o">&lt;=</span> <span class="n">parent_gas_limit</span> <span class="o">-</span> <span class="n">max_adjustment_delta</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">gas_limit</span> <span class="o">&lt;</span> <span class="n">GAS_LIMIT_MINIMUM</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="calculate-block-difficulty">
<h3>calculate_block_difficulty<a class="headerlink" href="#calculate-block-difficulty" title="Permalink to this headline"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="ethereum.tangerine_whistle.fork.calculate_block_difficulty">
<span class="sig-name descname"><span class="pre">calculate_block_difficulty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block_number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_difficulty</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ethereum.tangerine_whistle.fork.calculate_block_difficulty" title="Permalink to this definition"></a></dt>
<dd><p>Computes difficulty of a block using its header and parent header.</p>
<p>The difficulty is determined by the time the block was created after its
parent. The <code class="docutils literal notranslate"><span class="pre">offset</span></code> is calculated using the parent block’s difficulty,
<code class="docutils literal notranslate"><span class="pre">parent_difficulty</span></code>, and the timestamp between blocks. This offset is
then added to the parent difficulty and is stored as the <code class="docutils literal notranslate"><span class="pre">difficulty</span></code>
variable. If the time between the block and its parent is too short, the
offset will result in a positive number thus making the sum of
<code class="docutils literal notranslate"><span class="pre">parent_difficulty</span></code> and <code class="docutils literal notranslate"><span class="pre">offset</span></code> to be a greater value in order to
avoid mass forking. But, if the time is long enough, then the offset
results in a negative value making the block less difficult than
its parent.</p>
<p>The base standard for a block’s difficulty is the predefined value
set for the genesis block since it has no parent. So, a block
can’t be less difficult than the genesis block, therefore each block’s
difficulty is set to the maximum value between the calculated
difficulty and the <code class="docutils literal notranslate"><span class="pre">GENESIS_DIFFICULTY</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>block_number</strong> – Block number of the block.</p></li>
<li><p><strong>block_timestamp</strong> – Timestamp of the block.</p></li>
<li><p><strong>parent_timestamp</strong> – Timestamp of the parent block.</p></li>
<li><p><strong>parent_difficulty</strong> – difficulty of the parent block.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>difficulty</strong> – Computed difficulty for a block.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>ethereum.base_types.Uint</cite></p>
</dd>
</dl>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_block_difficulty</span><span class="p">(</span>
    <span class="n">block_number</span><span class="p">:</span> <span class="n">Uint</span><span class="p">,</span>
    <span class="n">block_timestamp</span><span class="p">:</span> <span class="n">U256</span><span class="p">,</span>
    <span class="n">parent_timestamp</span><span class="p">:</span> <span class="n">U256</span><span class="p">,</span>
    <span class="n">parent_difficulty</span><span class="p">:</span> <span class="n">Uint</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Uint</span><span class="p">:</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">parent_difficulty</span><span class="p">)</span>
        <span class="o">//</span> <span class="mi">2048</span>
        <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">block_timestamp</span> <span class="o">-</span> <span class="n">parent_timestamp</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">difficulty</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parent_difficulty</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
    <span class="c1"># Historical Note: The difficulty bomb was not present in Ethereum at the</span>
    <span class="c1"># start of Frontier, but was added shortly after launch. However since the</span>
    <span class="c1"># bomb has no effect prior to block 200000 we pretend it existed from</span>
    <span class="c1"># genesis.</span>
    <span class="c1"># See https://github.com/ethereum/go-ethereum/pull/1588</span>
    <span class="n">num_bomb_periods</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">block_number</span><span class="p">)</span> <span class="o">//</span> <span class="mi">100000</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">num_bomb_periods</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">difficulty</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">**</span><span class="n">num_bomb_periods</span>

    <span class="c1"># Some clients raise the difficulty to `MINIMUM_DIFFICULTY` prior to adding</span>
    <span class="c1"># the bomb. This bug does not matter because the difficulty is always much</span>
    <span class="c1"># greater than `MINIMUM_DIFFICULTY` on Mainnet.</span>
    <span class="k">return</span> <span class="n">Uint</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">difficulty</span><span class="p">,</span> <span class="n">MINIMUM_DIFFICULTY</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../tangerine_whistle_spurious_dragon.html" class="btn btn-neutral float-left" title="Tangerine Whistle → Spurious Dragon" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../index.html" class="btn btn-neutral float-right" title="Ethereum Tangerine WhistleSpurious Dragon Hardfork" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Ethereum.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>